"use strict";angular.module("espa.integratedSecurity",["espa.notificationChannel","toaster"]).run(["$rootScope","authService","$http","$timeout",function(n,t){console.log("espa.integratedSecurity run");t.getSecurityInfo().then(function(){});n.$on("$routeChangeStart",function(i,r){if(r.$$route!=undefined&&r.$$route.originalPath!=undefined){var u=r.$$route.originalPath;r.$$route.anonymous!=undefined&&(r.$$route.anonymous==undefined||r.$$route.anonymous)||(console.log("authorizeRoute"),t.authorizeRoute(u,u.replace("/","")));r.$$route.menuTitle&&(n.menuTitle=r.$$route.menuTitle);r.$$route.levelTree&&(n.levelTree=r.$$route.levelTree)}})}]).config(["$routeProvider",function(n){n.when("/403",{templateUrl:"appNugets/Espa.Angular.IntegratedSecurity/views/403.html",anonymous:!0})}]);angular.module("espa.integratedSecurity").service("notificationChannelAuthExt",["notificationChannel","notificationChannelConstants","$rootScope",function(n,t,i){t.events._END_AUTHENTICATION_="_END_AUTHENTICATION_";var r=angular.extend(n,{});r.authEnded=function(){i.$broadcast(t.events._END_AUTHENTICATION_)};r.onAuthEnded=function(n,i){n.$on(t.events._END_AUTHENTICATION_,function(){i()})}}]);angular.module("espa.integratedSecurity").service("authService",["$http","$q","securityConstants","$location","toaster","notificationChannel","notificationChannelAuthExt","$rootScope","integratedSecurityAppConfigConstants",function(n,t,i,r,u,f,e,o,s){if(!s.appConfig.securityInfoApiUrl)throw new Error("The -getSecurityInfoApiUrl- appConfig key is not present in the config file of the espa.integratedSecurity module");var w=s.appConfig.securityInfoApiUrl,c={},l="SecurityInfo_"+i.appNameSpace,a=function(){var i=t.defer();return k()?(console.log("Authentication process started"),n({cache:!1,method:"GET",url:w,withCredentials:!0}).success(function(n){i.resolve(n);y(n);console.log("Authentication process ended");f.authEnded()}).error(function(n){v("System");i.reject(n)})):i.resolve(h()),i.promise},tt=function(n,t){for(var r,u,i=0;i<t.length;i++)for(r=0;r<t[i].childs.length;r++)for(u=0;u<t[i].childs[r].childs.length;u++)if(t[i].childs[r].childs[u].webFactoryMenuId==n)return t[i].childs[r].childs[u].levelTree},v=function(n){var t="Access Denied to "+n;u.pop("error",t,"You are not authorized to view this page.");o.$evalAsync(function(){r.path("/403")})},y=function(n){localStorage.setItem(l,JSON.stringify(n))},b=function(){localStorage.removeItem(l)},h=function(){return JSON.parse(localStorage.getItem(l))},k=function(){var n=h(l),t,i;if(n&&n.userSecurity){if(t=moment(),i=moment(n.expiryDate,"DD/MM/YYYY"),t>=i)return!0}else return!0;return!1},p=function(n,t){var f=!1,u,r;if(c=h(),n=="access"&&c.accessAction&&(n=c.accessAction),c)for(u=c.userSecurity.permissions,r=0;r<u.length;r++)if(u[r].action.toLowerCase()==n.toLowerCase()&&u[r].route.toLowerCase()==t.toLowerCase()&&u[r].appNameSpace==i.appNameSpace){f=!0;break}return f},d=function(n){for(var t,u=i.permissions,f,r=0;r<u.length;r++)if(t=u[r],t.route==n&&t.access!=undefined){f=t.access;break}return f},g=function(){var n=h();return n.appPermissions},nt=function(n,t){p("access",n)||n=="/403"||(t=t!=undefined?t:"this route",v(t))};return{authorizeRoute:function(n,t){nt(n,t)},hasAccess:function(n,t){return p(n,t)},getPageAccess:function(n){return d(n)},getSecurityInfo:a,getAppPermissions:function(){return g()},getlocalStorage:function(){return h()},reset:function(){var n=h();b();a().then(function(){u.pop("success","Security","Permissions updated succesfully.");r.path("/dasboard")},function(){y(n)})},setApiUrl:function(n){_apiUrl=n}}}]);angular.module("espa.integratedSecurity").directive("espaDisplay",["authService","notificationChannel",function(n,t){var i=function(t,i,r,u){var f=n.hasAccess(t,i);f?r.css("display",u):r.css("display","none")};return{restrict:"A",scope:{action:"@espaDisplayaction",route:"@espaDisplayroute"},link:function(n,r){var e=r.css("display"),u,f,o;r.hide();u=n.action;f=n.route;i(u,f,r,e);o=function(){i(u,f,r,e)};t.onAuthEnded(n,o)}}}]);
/*
//# sourceMappingURL=integratedSecurityBundle.1.0.1.13.min.js.map
*/